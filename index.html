<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Research Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .dropzone {
            border: 2px dashed #cbd5e0;
            border-radius: 0.5rem;
            transition: all 0.3s;
        }
        .dropzone.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // PDF Upload Component
        const PDFUpload = ({ onUpload, uploadStatus, setUploadStatus }) => {
            const [isDragging, setIsDragging] = useState(false);
            const fileInputRef = useRef(null);

            const handleDragOver = (e) => {
                e.preventDefault();
                setIsDragging(true);
            };

            const handleDragLeave = (e) => {
                e.preventDefault();
                setIsDragging(false);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setIsDragging(false);
                const droppedFiles = Array.from(e.dataTransfer.files);
                handleFiles(droppedFiles);
            };

            const handleFileChange = (e) => {
                const selectedFiles = Array.from(e.target.files);
                handleFiles(selectedFiles);
            };

            const handleFiles = (files) => {
                // Filter for PDF files only
                const pdfFiles = files.filter(file => file.type === 'application/pdf');
                
                if (pdfFiles.length === 0) {
                    setUploadStatus({ message: 'Please upload PDF files only', error: true });
                    return;
                }
                
                onUpload(pdfFiles);
            };

            const handleClick = () => {
                fileInputRef.current.click();
            };

            return (
                <div className="bg-white rounded-xl shadow-md p-6">
                    <h2 className="text-xl font-semibold text-gray-800 mb-4">Upload Research PDFs</h2>
                    
                    <div 
                        className={`dropzone p-8 text-center cursor-pointer ${isDragging ? 'dragover' : ''}`}
                        onDragOver={handleDragOver}
                        onDragLeave={handleDragLeave}
                        onDrop={handleDrop}
                        onClick={handleClick}
                    >
                        <i className="fas fa-file-pdf text-4xl text-red-500 mb-3"></i>
                        <div className="mt-4 text-gray-600">
                            <p>Drag and drop PDF files here, or <span className="text-blue-600">click to browse</span></p>
                            <p className="text-sm text-gray-500 mt-1">Supports multiple PDF files</p>
                        </div>
                        <input 
                            ref={fileInputRef}
                            type="file" 
                            multiple 
                            accept=".pdf"
                            className="hidden"
                            onChange={handleFileChange}
                        />
                    </div>
                    
                    {uploadStatus && (
                        <div className={`mt-4 p-3 rounded-lg ${uploadStatus.error ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`}>
                            {uploadStatus.message} {uploadStatus.chunks && `(${uploadStatus.chunks} chunks processed)`}
                        </div>
                    )}
                </div>
            );
        };

        // Question Input Component
        const QuestionInput = ({ question, setQuestion, onAsk, isLoading }) => {
            const handleSubmit = (e) => {
                e.preventDefault();
                onAsk();
            };

            return (
                <div className="bg-white rounded-xl shadow-md p-6">
                    <h2 className="text-xl font-semibold text-gray-800 mb-4">Ask a Question</h2>
                    <form onSubmit={handleSubmit} className="flex flex-col sm:flex-row gap-4">
                        <input 
                            type="text" 
                            value={question}
                            onChange={(e) => setQuestion(e.target.value)}
                            placeholder="Enter your research question..."
                            className="flex-grow px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            disabled={isLoading}
                        />
                        <button 
                            type="submit"
                            disabled={isLoading || !question.trim()}
                            className="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                        >
                            {isLoading ? (
                                <>
                                    <div className="spinner w-4 h-4 mr-2"></div>
                                    Processing...
                                </>
                            ) : (
                                'Ask Question'
                            )}
                        </button>
                    </form>
                </div>
            );
        };

        // Results Display Component
        const ResultsDisplay = ({ results, isLoading }) => {
            if (isLoading) {
                return (
                    <div className="bg-white rounded-xl shadow-md p-8 text-center fade-in">
                        <div className="spinner w-12 h-12 mx-auto mb-4"></div>
                        <p className="text-gray-600">Analyzing your research documents...</p>
                    </div>
                );
            }

            if (!results) return null;

            return (
                <div className="bg-white rounded-xl shadow-md p-6 fade-in">
                    <h2 className="text-xl font-semibold text-gray-800 mb-6">Research Results</h2>
                    
                    {/* Answer Card */}
                    <div className="mb-6">
                        <h3 className="font-medium text-gray-700 mb-2">Answer:</h3>
                        <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <p className="text-gray-800">{results.answer}</p>
                        </div>
                    </div>
                    
                    {/* Confidence Score */}
                    <div className="mb-6">
                        <div className="flex justify-between items-center mb-1">
                            <h3 className="font-medium text-gray-700">Confidence Score:</h3>
                            <span className="text-sm font-medium text-gray-600">{Math.round(results.confidence * 100)}%</span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2.5">
                            <div 
                                className="progress-bar bg-blue-600 h-2.5 rounded-full" 
                                style={{ width: `${results.confidence * 100}%` }}
                            ></div>
                        </div>
                    </div>
                    
                    {/* Citations */}
                    <div>
                        <h3 className="font-medium text-gray-700 mb-2">Citations:</h3>
                        <div className="space-y-3">
                            {results.citations.map((citation, index) => (
                                <div key={index} className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <div className="flex items-start">
                                        <span className="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">
                                            {index + 1}
                                        </span>
                                        <p className="text-gray-800">{citation.text}</p>
                                    </div>
                                    {citation.source && (
                                        <p className="text-sm text-gray-500 mt-2">Source: {citation.source}</p>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // File List Component
        const FileList = ({ files, onRemove }) => {
            if (files.length === 0) return null;

            return (
                <div className="bg-white rounded-xl shadow-md p-6 fade-in">
                    <h2 className="text-xl font-semibold text-gray-800 mb-4">Uploaded Files</h2>
                    <ul className="divide-y divide-gray-200">
                        {files.map((file, index) => (
                            <li key={index} className="py-3 flex justify-between items-center">
                                <div className="flex items-center">
                                    <i className="fas fa-file-pdf text-red-500 mr-3"></i>
                                    <span className="text-gray-700">{file.name}</span>
                                </div>
                                <button 
                                    onClick={() => onRemove(index)}
                                    className="text-red-500 hover:text-red-700"
                                >
                                    <i className="fas fa-times"></i>
                                </button>
                            </li>
                        ))}
                    </ul>
                </div>
            );
        };

        // Main App Component
        const SmartResearchAssistant = () => {
            const [files, setFiles] = useState([]);
            const [question, setQuestion] = useState('');
            const [results, setResults] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [reportCount, setReportCount] = useState(0);
            const [uploadStatus, setUploadStatus] = useState(null);
            const [autoRefresh, setAutoRefresh] = useState(false);

            // Simulate auto-refresh every 30 seconds
            useEffect(() => {
                let interval;
                if (autoRefresh && results) {
                    interval = setInterval(() => {
                        handleQuery();
                    }, 30000);
                }
                
                return () => clearInterval(interval);
            }, [autoRefresh, results]);

            // Handle file upload
            const handleUpload = async (selectedFiles) => {
                const formData = new FormData();
                for (let i = 0; i < selectedFiles.length; i++) {
                    formData.append('files', selectedFiles[i]);
                }
                
                try {
                    setIsLoading(true);
                    // In a real app, you would use the actual API endpoint
                    // const response = await fetch('/upload', {
                    //     method: 'POST',
                    //     body: formData
                    // });
                    // const data = await response.json();
                    
                    // Simulate API response
                    setTimeout(() => {
                        const data = {
                            message: 'Upload successful',
                            chunks: selectedFiles.length * 3 // Simulate 3 chunks per file
                        };
                        
                        setUploadStatus(data);
                        setFiles([...files, ...selectedFiles]);
                        setIsLoading(false);
                    }, 1500);
                    
                } catch (error) {
                    console.error('Upload error:', error);
                    setUploadStatus({ message: 'Upload failed', error: true });
                    setIsLoading(false);
                }
            };

            // Handle file removal
            const handleRemoveFile = (index) => {
                const newFiles = [...files];
                newFiles.splice(index, 1);
                setFiles(newFiles);
            };

            // Handle query submission
            const handleQuery = async () => {
                if (!question.trim()) return;
                
                setIsLoading(true);
                
                try {
                    // In a real app, you would use the actual API endpoint
                    // const response = await fetch('/query', {
                    //     method: 'POST',
                    //     headers: {
                    //         'Content-Type': 'application/json'
                    //     },
                    //     body: JSON.stringify({ question })
                    // });
                    // const data = await response.json();
                    
                    // Simulate API response with variations
                    setTimeout(() => {
                        const responses = [
                            {
                                answer: `Based on the research documents, ${question} is addressed in several ways. The most effective approach appears to be combining multiple methodologies for optimal results.`,
                                confidence: 0.85,
                                citations: [
                                    { 
                                        text: "Research shows that this approach yields positive results in 85% of cases (Smith et al., 2022).",
                                        source: "Advanced Research Methods, pp. 112-115"
                                    },
                                    { 
                                        text: "A recent study demonstrated significant improvements when applying this methodology (Johnson, 2023).",
                                        source: "Journal of Scientific Studies, Vol. 15, Issue 2"
                                    },
                                    { 
                                        text: "The combined approach has been validated across multiple domains (Chen et al., 2021).",
                                        source: "International Conference on Research Innovations"
                                    }
                                ]
                            },
                            {
                                answer: `The research indicates that ${question} can be best understood through a multi-disciplinary lens. Recent breakthroughs in computational analysis have provided new insights into this area.`,
                                confidence: 0.92,
                                citations: [
                                    { 
                                        text: "Computational analysis has revolutionized this field (Brown, 2023).",
                                        source: "Data Science Review, Vol. 8"
                                    },
                                    { 
                                        text: "Interdisciplinary approaches yield more comprehensive results (Wilson & Lee, 2022).",
                                        source: "Journal of Interdisciplinary Research, pp. 45-52"
                                    }
                                ]
                            },
                            {
                                answer: `Studies suggest that ${question} requires a nuanced approach that considers contextual factors. The evidence points to three primary factors that influence outcomes in this domain.`,
                                confidence: 0.78,
                                citations: [
                                    { 
                                        text: "Contextual factors play a crucial role in determining outcomes (Martinez, 2021).",
                                        source: "Contextual Analysis Quarterly"
                                    },
                                    { 
                                        text: "A framework for understanding these factors was proposed in recent work (Taylor et al., 2023).",
                                        source: "Annual Review of Advanced Studies"
                                    }
                                ]
                            }
                        ];
                        
                        const data = responses[Math.floor(Math.random() * responses.length)];
                        setResults(data);
                        setIsLoading(false);
                        setReportCount(prev => prev + 1);
                    }, 2000);
                    
                } catch (error) {
                    console.error('Query error:', error);
                    setIsLoading(false);
                }
            };

            const toggleAutoRefresh = () => {
                setAutoRefresh(!autoRefresh);
            };

            return (
                <div className="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
                    <div className="max-w-4xl mx-auto">
                        <header className="text-center mb-12">
                            <h1 className="text-3xl font-bold text-gray-900 mb-2">Smart Research Assistant</h1>
                            <p className="text-gray-600">Upload PDFs and ask questions to get AI-powered insights</p>
                            <div className="mt-4 flex justify-center items-center space-x-4">
                                <div className="bg-blue-100 text-blue-800 py-1 px-3 rounded-full inline-flex items-center">
                                    <i className="fas fa-file-alt mr-2"></i>
                                    <span>Reports: {reportCount}</span>
                                </div>
                                <button 
                                    onClick={toggleAutoRefresh}
                                    className={`py-1 px-3 rounded-full inline-flex items-center ${autoRefresh ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}`}
                                >
                                    <i className={`fas ${autoRefresh ? 'fa-toggle-on' : 'fa-toggle-off'} mr-2`}></i>
                                    <span>Auto-Refresh</span>
                                </button>
                            </div>
                        </header>

                        <main className="space-y-8">
                            <PDFUpload 
                                onUpload={handleUpload} 
                                uploadStatus={uploadStatus} 
                                setUploadStatus={setUploadStatus} 
                            />
                            
                            <FileList files={files} onRemove={handleRemoveFile} />
                            
                            <QuestionInput 
                                question={question} 
                                setQuestion={setQuestion} 
                                onAsk={handleQuery} 
                                isLoading={isLoading} 
                            />
                            
                            <ResultsDisplay results={results} isLoading={isLoading} />
                        </main>

                        <footer className="mt-12 text-center text-gray-500 text-sm">
                            <p>Smart Research Assistant - Powered by AI • {new Date().getFullYear()}</p>
                        </footer>
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<SmartResearchAssistant />, document.getElementById('root'));
    </script>
</body>
</html>